[gd_scene load_steps=19 format=3 uid="uid://t3ii56h60cay"]

[ext_resource type="Theme" uid="uid://bwqifwabah580" path="res://Themes/logic_block.tres" id="1_ehnru"]
[ext_resource type="StyleBox" uid="uid://3jg85rnvy4dp" path="res://LogicBlockStyles/ButtonSettings/button_pressed.tres" id="2_8jrmb"]
[ext_resource type="StyleBox" uid="uid://debivnsimn71a" path="res://LogicBlockStyles/ButtonSettings/button_normal.tres" id="3_gd1kk"]
[ext_resource type="StyleBox" uid="uid://dd387wna6hgc7" path="res://LogicBlockStyles/ButtonSettings/option_button.tres" id="4_yxha3"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_flme0"]

[sub_resource type="GDScript" id="GDScript_r45a1"]
resource_name = "config_setting"
script/source = "extends PanelContainer



func _on_config_select_item_selected(index: int) -> void:
	for i in %Configs.get_children():
		i.visible = false
	
	print(index)
	%Configs.get_child(%ConfigSelect.get_selected_id()).visible = true



func _on_delete_button_pressed() -> void:
	self.queue_free()

func apply():
	
	var id = %ConfigSelect.get_selected_id()
	print(id)
	if id == 0:
		get_tree().root.get_child(0).editor_configs.max_fps = %MaxFPS.compile
	elif id == 1:
		get_tree().root.get_child(0).editor_configs.compile_when_close = %CompileWhenExit.compile
	elif id == 2:
		get_tree().root.get_child(0).editor_configs.ui_scale = %UIScale.compile
	
	get_tree().root.get_child(0).apply_config()
"

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_p0xfh"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_0x4sv"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_42qcc"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_6kfy8"]

[sub_resource type="GDScript" id="GDScript_ehnru"]
script/source = "extends PanelContainer

var compile




func _on_line_edit_text_changed(new_text: String) -> void:
	if new_text.is_valid_int():
	
		$HBoxContainer/HSlider.value = float($HBoxContainer/LineEdit.text)
	else:
		$HBoxContainer/LineEdit.text = \"60\"
		$HBoxContainer/HSlider.value = 60
		
	compile = int($HBoxContainer/LineEdit.text)


func _on_h_slider_drag_ended(value_changed: bool) -> void:
	$HBoxContainer/LineEdit.text = str(int($HBoxContainer/HSlider.value))
	compile = int($HBoxContainer/LineEdit.text)
"

[sub_resource type="GDScript" id="GDScript_8jrmb"]
script/source = "extends PanelContainer

var compile

func _on_check_button_toggled(toggled_on: bool) -> void:
	compile = toggled_on
"

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_gd1kk"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_yxha3"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_r45a1"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_rx08b"]

[sub_resource type="StyleBoxEmpty" id="StyleBoxEmpty_l0ldu"]

[sub_resource type="GDScript" id="GDScript_gd1kk"]
script/source = "extends PanelContainer

var compile : float
var changing := false

func _on_line_edit_text_changed(new_text: String) -> void:
	if new_text.is_valid_int():
	
		$HBoxContainer/HSlider.value = float($HBoxContainer/LineEdit.text)
	else:
		$HBoxContainer/LineEdit.text = \"1\"
		$HBoxContainer/HSlider.value = 1.0
		
	compile = int($HBoxContainer/LineEdit.text)

func _process(delta: float) -> void:
	if changing:
		$HBoxContainer/LineEdit.text = str(float($HBoxContainer/HSlider.value))
		compile = float($HBoxContainer/LineEdit.text)



func _on_h_slider_drag_ended(value_changed: bool) -> void:
	var count = 0
	while not compile:
		count += 1
		
		if count > 1024:
			break
		compile = float($HBoxContainer/LineEdit.text)
	changing = false


func _on_h_slider_drag_started() -> void:
	changing = true
"

[node name="ConfigSetting" type="PanelContainer"]
offset_right = 222.0
offset_bottom = 27.0
size_flags_vertical = 3
theme = ExtResource("1_ehnru")
theme_override_styles/panel = SubResource("StyleBoxEmpty_flme0")
script = SubResource("GDScript_r45a1")

[node name="HBoxContainer" type="HBoxContainer" parent="."]
layout_mode = 2
theme_override_constants/separation = 10

[node name="DeleteButton" type="Button" parent="HBoxContainer"]
custom_minimum_size = Vector2(0, 30)
layout_mode = 2
size_flags_vertical = 4
theme_override_styles/focus = SubResource("StyleBoxEmpty_p0xfh")
theme_override_styles/hover_pressed = ExtResource("2_8jrmb")
theme_override_styles/hover = ExtResource("3_gd1kk")
theme_override_styles/pressed = ExtResource("2_8jrmb")
theme_override_styles/normal = ExtResource("3_gd1kk")
text = "-"

[node name="ConfigSelect" type="OptionButton" parent="HBoxContainer"]
unique_name_in_owner = true
layout_mode = 2
size_flags_vertical = 4
theme_override_styles/focus = SubResource("StyleBoxEmpty_0x4sv")
theme_override_styles/hover_pressed = ExtResource("4_yxha3")
theme_override_styles/hover = ExtResource("4_yxha3")
theme_override_styles/pressed = ExtResource("4_yxha3")
theme_override_styles/normal = ExtResource("4_yxha3")
fit_to_longest_item = false
allow_reselect = true
item_count = 3
popup/item_0/text = "最高帧率"
popup/item_0/id = 0
popup/item_1/text = "窗口失焦时导出"
popup/item_1/id = 1
popup/item_2/text = "UI尺寸大小"
popup/item_2/id = 2

[node name="Configs" type="PanelContainer" parent="HBoxContainer"]
unique_name_in_owner = true
layout_mode = 2
theme_override_styles/panel = SubResource("StyleBoxEmpty_42qcc")

[node name="MaxFPS" type="PanelContainer" parent="HBoxContainer/Configs"]
unique_name_in_owner = true
visible = false
layout_mode = 2
theme_override_styles/panel = SubResource("StyleBoxEmpty_6kfy8")
script = SubResource("GDScript_ehnru")

[node name="HBoxContainer" type="HBoxContainer" parent="HBoxContainer/Configs/MaxFPS"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="LineEdit" type="LineEdit" parent="HBoxContainer/Configs/MaxFPS/HBoxContainer"]
layout_mode = 2
theme_override_constants/minimum_character_width = 3
text = "60"
expand_to_text_length = true

[node name="HSlider" type="HSlider" parent="HBoxContainer/Configs/MaxFPS/HBoxContainer"]
custom_minimum_size = Vector2(200, 0)
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 4
min_value = 15.0
max_value = 240.0
value = 60.0
ticks_on_borders = true

[node name="CompileWhenExit" type="PanelContainer" parent="HBoxContainer/Configs"]
unique_name_in_owner = true
visible = false
layout_mode = 2
theme_override_styles/panel = SubResource("StyleBoxEmpty_6kfy8")
script = SubResource("GDScript_8jrmb")

[node name="HBoxContainer" type="HBoxContainer" parent="HBoxContainer/Configs/CompileWhenExit"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="CheckButton" type="CheckButton" parent="HBoxContainer/Configs/CompileWhenExit/HBoxContainer"]
layout_mode = 2
theme_override_styles/focus = SubResource("StyleBoxEmpty_gd1kk")
theme_override_styles/hover_pressed = SubResource("StyleBoxEmpty_yxha3")
theme_override_styles/hover = SubResource("StyleBoxEmpty_r45a1")
theme_override_styles/pressed = SubResource("StyleBoxEmpty_rx08b")
theme_override_styles/normal = SubResource("StyleBoxEmpty_l0ldu")

[node name="UIScale" type="PanelContainer" parent="HBoxContainer/Configs"]
unique_name_in_owner = true
visible = false
layout_mode = 2
theme_override_styles/panel = SubResource("StyleBoxEmpty_6kfy8")
script = SubResource("GDScript_gd1kk")

[node name="HBoxContainer" type="HBoxContainer" parent="HBoxContainer/Configs/UIScale"]
layout_mode = 2
theme_override_constants/separation = 10

[node name="LineEdit" type="LineEdit" parent="HBoxContainer/Configs/UIScale/HBoxContainer"]
layout_mode = 2
theme_override_constants/minimum_character_width = 3
text = "1"
expand_to_text_length = true

[node name="HSlider" type="HSlider" parent="HBoxContainer/Configs/UIScale/HBoxContainer"]
custom_minimum_size = Vector2(200, 0)
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 4
min_value = 0.2
max_value = 3.0
step = 0.1
value = 1.0
ticks_on_borders = true

[connection signal="pressed" from="HBoxContainer/DeleteButton" to="." method="_on_delete_button_pressed"]
[connection signal="item_selected" from="HBoxContainer/ConfigSelect" to="." method="_on_config_select_item_selected"]
[connection signal="text_changed" from="HBoxContainer/Configs/MaxFPS/HBoxContainer/LineEdit" to="HBoxContainer/Configs/MaxFPS" method="_on_line_edit_text_changed"]
[connection signal="drag_ended" from="HBoxContainer/Configs/MaxFPS/HBoxContainer/HSlider" to="HBoxContainer/Configs/MaxFPS" method="_on_h_slider_drag_ended"]
[connection signal="toggled" from="HBoxContainer/Configs/CompileWhenExit/HBoxContainer/CheckButton" to="HBoxContainer/Configs/CompileWhenExit" method="_on_check_button_toggled"]
[connection signal="text_changed" from="HBoxContainer/Configs/UIScale/HBoxContainer/LineEdit" to="HBoxContainer/Configs/UIScale" method="_on_line_edit_text_changed"]
[connection signal="drag_ended" from="HBoxContainer/Configs/UIScale/HBoxContainer/HSlider" to="HBoxContainer/Configs/UIScale" method="_on_h_slider_drag_ended"]
[connection signal="drag_started" from="HBoxContainer/Configs/UIScale/HBoxContainer/HSlider" to="HBoxContainer/Configs/UIScale" method="_on_h_slider_drag_started"]
